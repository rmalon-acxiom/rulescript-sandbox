<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <title>Acxiom Impact&trade; | RuleScript Sandbox</title>
    <meta content="IE=9" http-equiv="X-UA-Compatible" />
    <link href='https://fonts.googleapis.com/css?family=Maven+Pro:400,500,700' rel='stylesheet' type='text/css'>
    <link href='lib/gen.css' rel='stylesheet' type='text/css'>
</head>

<body>
    <div id="container">
        <!-- HEADER & NAVIGATION -->
        <div id="nav">
            <img src="lib/impactlogo.png" width="165" height="auto" style="margin:2px 0 0 10px;" alt="acxiom | Impact&trade;" class="fl">

            <div class="fr" title="Menu">
                <button class="c-hamburger c-hamburger--htra">
                    <span>toggle menu</span>
                </button>
            </div>
            <h3 class="help fr" title="Help">?</h3>
            <h1 class="nav fr">RuleScript Sandbox</h1>
            <div id="header"></div>
        </div>
        <!-- HIDDEN MENU BAR -->
        <div id="menubar">
            <ul class="navi">
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/ASCII%20Check/DCS_ASCII_Check.html">ASCII&nbsp;Check</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Comments%20to%20RS/DCS_Comments_to_RS.html">Comments to RS</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Excel%20to%20JS/DCS_Excel_to_JSObject.html">Excel to JS</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/RS%20Sandbox/DCS_RS_Sandbox.html">RuleScript&#160;Sandbox</a>
                </li>
                <li class="navi"><a class="navi bright active" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/RS%20Sandbox/DCS_RS_Sandbox.html">RuleScript&#160;Sandbox <span class="sup_tag">BETA</span></a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Social%20Tool/DCS_Social_Tool.html">Social&nbsp;Links</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Compare%20Tool/DCS_Compare_Tool.html">Text&nbsp;Compare</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/URL%20Encoder/DCS_URL_Encoder.html">URL&nbsp;Encoder</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Rulescript%20Basics/RuleScript_Basics.html">RuleScript Basics</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Rulescript%20Reference/Rulescript_Reference.html">Rulescript Reference</a>
                </li>
                <li class="navi"><a class="navi bright" href="https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/Impact%20Tags%20Reference/Impact_Tags_Reference.html">Impact Tags Reference</a>
                </li>
            </ul>
        </div>
        <!-- DATA COLUMN -->
        <div id="data">
          <div class="header">
            <h1 class="fl">Set Data</h1>
            <div id="data_controls"><span class="clear" title="Reset Data">&#128260;</span>&#160;&#160;<span class="add_data" title="Add Data">&#10010;</span></div>
          </div>
          <div class="data_input">
            <div class="input_block">
              <input class="top" placeholder="Attribute"/>
              <input class="bottom" placeholder="Value"/>
            </div>
          </div>
        </div>
        <!-- EDITOR COLUMN -->
        <div id="main">
            <div id="tabs">
              <ul class="tabs">
                <li class="tabs active">New Rule <span class="close" title="Close Tab">&#10060;</span></li>
                <li class="tabs">Another Rule <span class="close" title="Close Tab">&#10060;</span></li>
                <li class="tabs add" title="Add Tab">&#10010;</li>
              </ul>
            </div>
            <!-- EDITOR DIV -->
            <div id="editor">// WIP

function foo(items) {
    var x = "All this is syntax highlighted";
    return x;
}</div>
          <!-- RUN BLOCK -->
          <div id="runblock" title="Execute Rule (Alt+R)">
            <span class="link" title="Share Rule (Alt+S)">&#128279;</span>
            <div id="run">RUN</div>
          </div>
          <!-- CONSOLE -->
          <div id="console">
            <div id="resizer"><span class="lines"></span></div>
            <div id="move_console">
              <div id="con_header" class="header">OUTPUT <span class="reset fr" title="Reset Console">&#128260;</span></div>
              <div id="print_console">
                <div id="output">
                  <b>Error:</b> Unrecoverable syntax error.<br />
                </div>
                  <div id="output">
                    <b>Error:</b> Unrecoverable syntax error.<br />
                  </div>
                    <div id="output">
                      <b>Error:</b> Unrecoverable syntax error.<br />
                    </div>
                      <div id="output">
                        <b>Error:</b> Unrecoverable syntax error.<br />
                      </div>
                        <div id="output">
                          <b>Error:</b> Unrecoverable syntax error.<br />
                        </div>
                          <div id="output">
                            <b>Error:</b> Unrecoverable syntax error.<br />
                          </div>
                            <div id="output">
                              <b>Error:</b> Unrecoverable syntax error.<br />
                            </div>
                              <div id="output">
                                <b>Error:</b> Unrecoverable syntax error.<br />
                              </div>
                                <div id="output">
                                  <b>Error:</b> Unrecoverable syntax error.<br />
                                </div>
                                  <div id="output">
                                    <b>Error:</b> Unrecoverable syntax error.<br />
                                  </div>
                                    <div id="output">
                                      <b>Error:</b> Unrecoverable syntax error.<br />
                                    </div>
                                      <div id="output">
                                        <b>Error:</b> Unrecoverable syntax error.<br />
                                      </div>
                                        <div id="output">
                                          <b>Error:</b> Unrecoverable syntax error.<br />
                                        </div>
                                          <div id="output">
                                            <b>Error:</b> Unrecoverable syntax error.<br />
                                          </div>
                                            <div id="output">
                                              <b>Error:</b> Unrecoverable syntax error.<br />
                                            </div>
                                              <div id="output">
                                                <b>Error:</b> Unrecoverable syntax error.<br />
                                              </div>
                                                <div id="output">
                                                  <b>Error:</b> Unrecoverable syntax error.<br />
                                                </div>
                                                  <div id="output">
                                                    <b>Error:</b> Unrecoverable syntax error.<br />
                                                  </div>
                                                    <div id="output">
                                                      <b>Error:</b> Unrecoverable syntax error.<br />
                                                    </div>
              </div>
            </div>
          </div>
        </div>
        <!-- FOOTER -->
        <div id="footer">
            <div id="wrapper" class="gf">
                <div class="fl gf">&copy;
                    <script>
                        document.write(new Date().getFullYear())
                    </script>
                    <noscript>
                        2015
                    </noscript>
                    Acxiom </div>
                <div class="fr gf">
                    <a id="changelog">Changelog</a> |
                    <script language="JavaScript">
                        var username = "timull";
                        var hostname = "acxiom.com";
                        var linktext = "Report a Problem";
                        document.write("<a href='" + "mail" + "to:" + username + "@" + hostname + "?subject=Issue with RuleScript Sandbox'>" + linktext + "</a>");
                    </script>
                </div>
            </div>
        </div>
    </div>
    <!-- jquery for stupid smooth stuff -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="lib/ace.js" type="text/javascript" charset="utf-8"></script>
    <!-- move all of this to an external file after development -->
    <script>
        // TODO: Keep rules in local storage
          // http://www.w3schools.com/HTML/html5_webstorage.asp
        // TODO: Make rules shareable - bitly api?
          // http://dev.bitly.com/get_started.html

        // ACE Editor Settings
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/chrome");
        editor.getSession().setMode("ace/mode/javascript");
        editor.getSession().setUseWrapMode(true);
        editor.setShowPrintMargin(false);
        editor.setFontSize(13);

        // Draggable Console
        var resFlag = false;
        var Draggable = function (id, initB, initR) {
        var el = document.getElementById(id),
            co = document.getElementById('console'),
            isDragReady = false,
            dragoffset = {
              x: 0,
              y: 0
            };

        this.init = function () {
          //el.style.position = "absolute";
          //el.style.bottom = initB;
          //el.style.right = initR;
          this.events();
        };

        // events for the element
        this.events = function () {
          var self = this;
          _on(el, 'mousedown', function (e) {
            if (!resFlag) {isDragReady = true;}
            // crossbrowser mouse pointer values
            e.pageX = e.pageX || e.clientX + (document.documentElement.scrollLeft ?
              document.documentElement.scrollLeft :
              document.body.scrollLeft);
            e.pageY = e.pageY || e.clientY + (document.documentElement.scrollTop ?
              document.documentElement.scrollTop :
              document.body.scrollTop);
            dragoffset.x = e.pageX - (co.offsetLeft + co.offsetWidth);
            dragoffset.y = e.pageY - (co.offsetTop + co.offsetHeight);
          });
          _on(document, 'mouseup', function () {
            isDragReady = false;
          });
          _on(document, 'mousemove', function (e) {
            if (isDragReady) {
              e.pageX = e.pageX || e.clientX + (document.documentElement.scrollLeft ?
                document.documentElement.scrollLeft :
                document.body.scrollLeft);
              e.pageY = e.pageY || e.clientY + (document.documentElement.scrollTop ?
                document.documentElement.scrollTop :
                document.body.scrollTop);
              //el.style.bottom = ((document.getElementById('main').offsetHeight + dragoffset.y) - e.pageY) + "px";
              //el.style.right = ((document.getElementById('main').offsetWidth + dragoffset.x) - e.pageX) + "px";
              document.getElementById('console').style.bottom = ((document.getElementById('main').offsetHeight + dragoffset.y) - e.pageY) + "px";
              document.getElementById('console').style.right = ((document.getElementById('main').offsetWidth + dragoffset.x) - e.pageX) + "px";
            }
          });
        };
        //cross browser event Helper function
        var _on = function (el, event, fn) {
          document.attachEvent ? el.attachEvent('on' + event, fn) : el.addEventListener(event, fn, !0);
        };
        this.init();
      }
      new Draggable('con_header', '10px', '10px');

      // Resizeable Console
      var con = document.getElementById('console'),
          res = document.getElementById('resizer');
      res.addEventListener('mousedown', initDrag, false);

      var startX, startY, startWidth, startHeight;

      function initDrag(e) {
        resFlag = true;
         startX = e.pageX + con.offsetWidth;
         startY = e.pageY + con.offsetHeight;
         startWidth = parseInt(document.defaultView.getComputedStyle(res).width, 10);
         startHeight = parseInt(document.defaultView.getComputedStyle(res).height, 10);
         document.documentElement.addEventListener('mousemove', doDrag, false);
         document.documentElement.addEventListener('mouseup', stopDrag, false);
      }

      function doDrag(e) {
        resFlag = true;
         con.style.width = (startX - e.pageX) + 'px';
         con.style.height = (startY - e.pageY) + 'px';
      }

      function stopDrag(e) {
          resFlag = false;
          document.documentElement.removeEventListener('mousemove', doDrag, false);
          document.documentElement.removeEventListener('mouseup', stopDrag, false);
      }

        // jQuery stuff - replace this with pure js later
        $.noConflict();
        jQuery(document).ready(function ($) {
            // Populate Menu
            $.ajax({
                url: "https://connected.acxiom.com/sites/emarketingdelivery/cs/WebBased%20Tools%20and%20Pages/ASCII%20Check/master_menu.txt",
                success: function (result) {
                    $("#menubar").html(result);
                }
            });
            // Function for Menu Toggle Animation
            (function () {
                var toggles = document.querySelectorAll(".c-hamburger");
                for (var i = toggles.length - 1; i >= 0; i--) {
                    var toggle = toggles[i];
                    toggleHandler(toggle);
                };

                function toggleHandler(toggle) {
                    toggle.addEventListener("click", function (e) {
                        e.preventDefault();
                        if (this.classList.contains("is-active") === true) {
                            this.classList.remove("is-active");
                            this.title = 'Menu';
                            $('#menubar').hide('slide', {
                                direction: 'right'
                            }, 250);
                        } else {
                            this.classList.add("is-active");
                            this.title = 'Collapse';
                            $('#menubar').show('slide', {
                                direction: 'right'
                            }, 250);
                        }
                    });
                }
            })();
        });
    </script>
</body>

</html>
